# Natural Language adaptation of the ETHOS_ARES MIMIC-IV event config for Foresight.
# Adapted from: https://github.com/ipolharvard/ethos-ares/blob/2d54383997318eb52f3d47b5969a66fc166b71ff/scripts/meds/mimic/configs/event_configs-ed.yaml
#
# Key modifications for narrative representation:
# - Replaces structured codes with descriptive natural language phrases and semantic connectors.
# - Uses human-readable titles/descriptions (e.g., ICD titles) instead of raw identifiers.
# - Explicitly models units and splits compound events (e.g., Blood Pressure) for clarity.
# - Comments out fields unused in the target tokenization to reduce noise.

subject_id_col: subject_id
ed/edstays:
  ed_registration:
    code:
      - "EMERGENCY_DEPARTMENT_REGISTRATION"
      - "ARRIVAL_TRANSPORT"
    time: col(intime)
    time_format: "%Y-%m-%d %H:%M:%S"
    text_value: arrival_transport
    hadm_id: hadm_id
    stay_id: stay_id
  ed_out:
    code:
      - "EMERGENCY_DEPARTMENT_DISCHARGE"
      - "TO"
    time: col(outtime)
    time_format: "%Y-%m-%d %H:%M:%S"
    text_value: disposition
    hadm_id: hadm_id
    stay_id: stay_id

# Units set as text_value so can be append as suffix for natural language representation
ed/triage:
  temperature:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "TEMPERATURE_°C"
    numeric_value: temperature
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  heart_rate:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "HEART_RATE_BPM"
    numeric_value: heartrate
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  respiratory_rate:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "RESPIRATORY_RATE_BREATHS/MIN"
    numeric_value: resprate
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  o2_saturation:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "O2_SATURATION_%"
    numeric_value: o2sat
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
# Treat systolic and diastolic blood pressure seperately so can filter null values seperately
  systolic_blood_pressure:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "SYSTOLIC_BLOOD_PRESSURE_MMHG"
    numeric_value: sbp
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  diastolic_blood_pressure:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "DIASTOLIC_BLOOD_PRESSURE_MMHG"
    numeric_value: dbp
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  pain:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "PAIN_SCORE"
    # Pain is a string not numeric in MIMIC-IV
    text_value: pain
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  acuity:
    code:
      - "EMERGENCY_DEPARTMENT_TRIAGE"
      - "SEVERITY_SCORE_(1_HIGH_-_5_LOW)" # Severity makes more semantic sense than acuity (to me)
    numeric_value: acuity
    time: col(intime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  # Free text so dropped to allow for structured vs LLM comparison
  # chiefcomplaint:
  #   code:
  #     - "EMERGENCY_DEPARTMENT_TRIAGE"
  #     - "CHIEF_COMPLAINT"
  #   text_value: chiefcomplaint
  #   time: col(intime)
  #   time_format:
  #     - "%Y-%m-%d %H:%M:%S"
  #   stay_id: stay_id

ed/diagnosis:
  diagnosis:
    code:
      - "EMERGENCY_DEPARTMENT_DIAGNOSIS"
      - ICD
      - col(icd_version)
      - col(icd_code)
    # Long title derived from icd_version and code
    text_value: col(icd_title)
    stay_id: stay_id
    time: col(outtime)
    time_format: "%Y-%m-%d %H:%M:%S"

hosp/admissions:
  admission:
    code:
      - "HOSPITAL_ADMISSION"
      - "TYPE"
      - col(admission_type)
      - "FROM"
      - col(admission_location)
    time: col(admittime)
    time_format: "%Y-%m-%d %H:%M:%S"
  # Multiple insurance, marital status, and race are recorded
  # Using heuristics such as most frequent is messy when truncating at "DIFFERING_PREDICTION_POINTS"
  # So we just include them as recorded both in terms of time and value
  # Then don't have to worry about static variables for truncation etc
  insurance:
    code:
      - "HOSPITAL_ADMISSION"
      - "INSURANCE"
    text_value: col(insurance)
    time: col(admittime)
    time_format: "%Y-%m-%d %H:%M:%S"
  marital_status:
    code:
      - "HOSPITAL_ADMISSION"
      - "MARITAL_STATUS"
    text_value: col(marital_status)
    time: col(admittime)
    time_format: "%Y-%m-%d %H:%M:%S"
  race:
    code:
      - "HOSPITAL_ADMISSION"
      - "RACE"
    text_value: col(race)
    time: col(admittime)
    time_format: "%Y-%m-%d %H:%M:%S"
  # Gender joined from subjects table
  gender:
    code:
      - "HOSPITAL_ADMISSION"
      - "GENDER"
    text_value: col(gender)
    time: col(admittime)
    time_format: "%Y-%m-%d %H:%M:%S"
  # Language not used in Ethos-ARES tokenization
  # language:
  #   code:
  #     - "HOSPITAL_ADMISSION"
  #     - "LANGUAGE"
  #     - col(language)
  #   time: col(admittime)
  #   time_format: "%Y-%m-%d %H:%M:%S"
  discharge:
    code:
      - "HOSPITAL_DISCHARGE"
      - "LOCATION"
      - col(discharge_location)
    time: col(dischtime)
    time_format: "%Y-%m-%d %H:%M:%S"
    hadm_id: hadm_id
  # We omit the death event here as it is joined to the data in the subjects table in the pre-MEDS step.

hosp/diagnoses_icd:
  diagnosis:
    code:
      - "HOSPITAL_DIAGNOSIS"
      - ICD
      - col(icd_version)
      - col(icd_code)
    # Long title derived from icd_version and code
    text_value: col(long_title)
    hadm_id: hadm_id
    time: col(dischtime)
    time_format: "%Y-%m-%d %H:%M:%S"

hosp/drgcodes:
  drg:
    code:
      - "DIAGNOSIS_RELATED_GROUPS"
      # Code adds no more information over the description
      - col(description)
    hadm_id: hadm_id
    time: col(dischtime)
    time_format: "%Y-%m-%d %H:%M:%S"
    # Filter by drg_type to only HCFA so not needed in code
    text_value: col(drg_type)
    # Not used in Ethos-ARES tokenization
    # drg_severity: drg_severity
    # drg_mortality: drg_mortality

hosp/emar:
  medication:
    code:
      - "HOSPITAL_MEDICATION"
      - col(medication)
      - col(event_txt)
    time: col(charttime)
    time_format: "%Y-%m-%d %H:%M:%S"
    hadm_id: hadm_id
    # Not used in Ethos-ARES tokenization
    # emar_id: emar_id
    # emar_seq: emar_seq

ed/pyxis:
  medication:
    code:
      - "EMERGENCY_DEPARTMENT_MEDICATION"
      - col(name)
      - "DISPENSED" # Correct term according to docs (https://physionet.org/content/mimic-iv-ed/2.2/_)
    time: col(charttime)
    time_format: "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id

hosp/hcpcsevents:
  hcpcs:
    code:
      - "HEALTHCARE_COMMON_PROCEDURE_CODING_SYSTEM"
      # Use long_description instead of short_description (still unique)
      - col(long_description)
    hadm_id: hadm_id
    time: col(chartdate)
    # Set to EOD in pre-MEDS so already in Datetime format
    # time_format: "%Y-%m-%d %H:%M:%S"

hosp/labevents:
  lab:
    code:
      - "LABORATORY_RESULT"
      # Fluid + label derived from itemid and unique
      - col(fluid)
      - col(label)
      - col(valueuom)
    hadm_id: hadm_id
    time: col(charttime)
    time_format: "%Y-%m-%d %H:%M:%S"
    numeric_value: valuenum
    # ETHOS-ARES only uses valuenum column downstream
    # This drops (free text) information from value and comments columns
    # text_value: value
    # priority: priority

ed/vitalsign:
  temperature:
    code:
      - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
      - "TEMPERATURE_°C"
    numeric_value: temperature
    time: col(charttime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  heart_rate:
    code:
      - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
      - "HEART_RATE_BPM"
    numeric_value: heartrate
    time: col(charttime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  respiratory_rate:
    code:
      - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
      - "RESPIRATORY_RATE_BREATHS/MIN"
    numeric_value: resprate
    time: col(charttime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  o2_saturation:
    code:
      - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
      - "O2_SATURATION_%"
    numeric_value: o2sat
    time: col(charttime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  diastolic_blood_pressure:
    code:
      - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
      - "DIASTOLIC_BLOOD_PRESSURE_MMHG"
    numeric_value: dbp
    time: col(charttime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  systolic_blood_pressure:
    code:
      - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
      - "SYSTOLIC_BLOOD_PRESSURE_MMHG"
    numeric_value: sbp
    time: col(charttime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  pain:
    code:
      - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
      - "PAIN_SCORE"
    text_value: pain
    time: col(charttime)
    time_format:
      - "%Y-%m-%d %H:%M:%S"
    stay_id: stay_id
  # Not in Ethos-ARES as free text field
  # heart_rhythm:
  #   code:
  #     - "EMERGENCY_DEPARTMENT_VITAL_SIGNS"
  #     - "HEART_RHYTHM"
  #     - col(rhythm)
  #   time: col(charttime)
  #   time_format:
  #     - "%Y-%m-%d %H:%M:%S"

hosp/omr:
  omr:
    code:
      - "OBSERVATION_MEDICAL_RECORD"
      - col(result_name)
    text_value: col(result_value)
    time: col(chartdate)
    # Set to EOD in pre-MEDS so already in Datetime format
    # time_format: "%Y-%m-%d %H:%M:%S"

hosp/patients:
  dob:
    code:
      # Not using the MEDS official code for birth (MEDS_BIRTH) due to semantics also include gender.
      - "BIRTH"
      - "GENDER"
    text_value: col(gender)
    time: col(year_of_birth)
    # Set as Y-01-01 00:00:00 internally in pre-MEDS
    # Leave at 00:00:00 to ensure no events come before this event
    time_format: "%Y"
  death:
    code:
      # Not using the MEDS official code for death (MEDS_DEATH) due to semantics.
      - "DEATH"
      - "DIED"
    time: col(dod)
    # Set to EOD in pre-MEDS so already in Datetime format
    # time_format:
    #   - "%Y-%m-%d %H:%M:%S"
    #   - "%Y-%m-%d"

# Not used in ETHOS-ARES tokenization
#hosp/pharmacy:
#  medication_start:
#    code:
#      - MEDICATION
#      - START
#      - col(medication)
#    time: col(starttime)
#    route: route
#    frequency: frequency
#    doses_per_24_hrs: doses_per_24_hrs
#    poe_id: poe_id
#    time_format:
#      - "%Y-%m-%d %H:%M:%S"
#      - "%Y-%m-%d"
#  medication_stop:
#    code:
#      - MEDICATION
#      - STOP
#      - col(medication)
#    time: col(stoptime)
#    poe_id: poe_id
#    time_format:
#      - "%Y-%m-%d %H:%M:%S"
#      - "%Y-%m-%d"

hosp/procedures_icd:
  procedure:
    code:
      - "HOSPITAL_PROCEDURE"
      - "ICD"
      - col(icd_version)
      - col(icd_code)
    # Long title derived from icd_version and code
    text_value: col(long_title)
    hadm_id: hadm_id
    time: col(chartdate)
    # Set to EOD in pre-MEDS so already in Datetime format
    # time_format: "%Y-%m-%d %H:%M:%S"

hosp/transfers:
  transfer:
    code:
      - "HOSPITAL_TRANSFER"
      - col(eventtype)
      - "TO"
      - col(careunit)
    time: col(intime)
    time_format: "%Y-%m-%d %H:%M:%S"
    hadm_id: hadm_id

icu/icustays:
  icu_admission:
    code:
      - "ICU_ADMISSION"
      - col(first_careunit)
    time: col(intime)
    time_format: "%Y-%m-%d %H:%M:%S"
    hadm_id: hadm_id
    icustay_id: stay_id
  icu_discharge:
    code:
      - "ICU_DISCHARGE"
      - col(last_careunit)
    time: col(outtime)
    time_format: "%Y-%m-%d %H:%M:%S"
    hadm_id: hadm_id
    icustay_id: stay_id

# Not used in ETHOS-ARES tokenization
#icu/chartevents:
#  event:
#    code:
#      - LAB
#      - col(itemid)
#      - col(valueuom)
#    time: col(charttime)
#    time_format: "%Y-%m-%d %H:%M:%S"
#    numeric_value: valuenum
#    text_value: value
#    hadm_id: hadm_id
#    icustay_id: stay_id

#icu/procedureevents:
#  start:
#    code:
#      - PROCEDURE
#      - START
#      - col(itemid)
#    time: col(starttime)
#    time_format: "%Y-%m-%d %H:%M:%S"
#    hadm_id: hadm_id
#    icustay_id: stay_id
#  end:
#    code:
#      - PROCEDURE
#      - END
#      - col(itemid)
#    time: col(endtime)
#    time_format: "%Y-%m-%d %H:%M:%S"
#    hadm_id: hadm_id
#    icustay_id: stay_id
#
#icu/inputevents:
#  input_start:
#    code:
#      - INFUSION_START
#      - col(itemid)
#    time: col(starttime)
#    time_format: "%Y-%m-%d %H:%M:%S"
#    hadm_id: hadm_id
#    icustay_id: stay_id
#    order_id: orderid
#    link_order_id: linkorderid
#    numeric_value: rate
#    unit: rateuom
#    ordercategorydescription: ordercategorydescription
#  input_end:
#    code:
#      - INFUSION_END
#      - col(itemid)
#    time: col(endtime)
#    time_format: "%Y-%m-%d %H:%M:%S"
#    hadm_id: hadm_id
#    icustay_id: stay_id
#    order_id: orderid
#    link_order_id: linkorderid
#    numeric_value: amount
#    ordercategorydescription: ordercategorydescription
#    statusdescription: statusdescription
#    unit: amountuom
#  subject_weight:
#    code:
#      - SUBJECT_WEIGHT_AT_INFUSION
#      - KG
#    time: col(starttime)
#    time_format: "%Y-%m-%d %H:%M:%S"
#    numeric_value: patientweight
#
#icu/outputevents:
#  output:
#    code:
#      - SUBJECT_FLUID_OUTPUT
#      - col(itemid)
#      - col(valueuom)
#    time: col(charttime)
#    time_format: "%Y-%m-%d %H:%M:%S"
#    hadm_id: hadm_id
#    icustay_id: stay_id
#    numeric_value: value
